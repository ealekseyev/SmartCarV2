# Face Recognition Configuration

recognition:
  # Similarity threshold for face matching
  # Higher = more strict (fewer false positives, more false negatives)
  # Lower = more lenient (more false positives, fewer false negatives)
  # Range: 0.0 to 1.0
  # Recommended: 0.30-0.40 for InsightFace models
  # If getting false positives at 0.4, use 0.45 or higher
  similarity_threshold: 0.6

  # Embedding size (must match model)
  embedding_size: 512

  # Device for inference
  device: cpu  # Options: cpu, cuda, cuda:0, etc.

  # Directory to store individual face embeddings
  faces_dir: data/faces

# Authorized Users
# List of users who are authorized to start the car
# Each user should have a corresponding embedding file in faces_dir
# Format: {username}.npz
authorized_users:
  - evan_nicholas
  - evan_low_light
  #- evan_beard

# Face Detection Configuration
detection:
  # Detector type: haar_cascade, int8_haar_cascade, blazeface, or dnn
  # - haar_cascade: Fast, classical detector (good for CPU, less accurate)
  # - int8_haar_cascade: INT8 optimized Haar (faster, uses uint8 images)
  # - blazeface: Modern lightweight detector (requires ONNX model)
  # - dnn: OpenCV DNN face detector (balance of speed and accuracy)
  detector_type: int8_haar_cascade

  # Model path for BlazeFace (only used if detector_type=blazeface)
  # Leave empty to auto-search in models/ directory
  blazeface_model_path: ""

  # Confidence threshold for face detection
  confidence_threshold: 0.7

  # NMS (Non-Maximum Suppression) threshold for BlazeFace
  nms_threshold: 0.3

  # Minimum face size (pixels) - width OR height
  min_face_size: 80

  # Face crop padding (fraction of bbox)
  crop_padding: 0.2

# Temporal Filtering
# Prevents flickering/false detections by requiring persistence
temporal:
  # Minimum consecutive frames a face must be detected before showing
  # Higher = more stable, less flickering, but slower response
  # Set to 1 for immediate display (no temporal filtering)
  # Recommended: 3-5 for reducing jitter and false detections
  min_frames_to_show: 3

  # Maximum frames to keep face "alive" if lost
  # If face disappears for less than this, keep showing it
  # Set to 0 for no persistence (immediate removal)
  # Recommended: 5-10 for smooth tracking despite brief occlusions
  max_frames_missing: 2

  # IoU (Intersection over Union) threshold for matching faces across frames
  # Higher = stricter matching (same face must overlap more)
  # Lower = looser matching (can track faces that move more between frames)
  # Range: 0.0 to 1.0
  # Recommended: 0.3 for normal tracking
  iou_threshold: 0.2

# Authentication Engine
# High-stakes decision making for actions like car auto-start
authentication:
  enabled: true
  # List of users who can unlock (any one of these can authenticate)
  # Leave as string for single user, or use list for multiple
  authorized_users:
    - evan_nicholas
    - evan_low_light
  min_frames_required: 5
  weighted_confidence_threshold: 0.75
  min_single_frame_confidence: 0.60
  max_bbox_movement_pixels: 100.0
  history_size: 10

# State Machine
# Controls LOCKED/UNLOCKED transitions
state_machine:
  enabled: true
  # Number of frames to check for stay-unlocked criteria
  unlock_window_frames: 500
  # Minimum detections in window to stay unlocked
  unlock_required_detections: 2
